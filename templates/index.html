<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description"
        content="Advanced GIS mapping application with interactive features, location data visualization, and real-time search capabilities">
    <title>GIS Pro - Advanced Mapping Platform</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

    <!-- Leaflet Draw CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/advanced-features.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-pro.css') }}">
</head>

<body>
    <div id="app">
        <!-- Header -->
        <div class="header">
            <a href="/" class="logo-section" id="logoLink" style="text-decoration: none; cursor: pointer;">
                <div class="logo">
                    <i class="fas fa-globe-americas" style="color: white; font-size: 1.2rem;"></i>
                </div>
                <div class="brand">
                    <h1>GIS Pro</h1>
                    <p>Advanced Mapping Platform</p>
                </div>
            </a>

            <div class="search-container">
                <span class="search-icon"><i class="fas fa-search"></i></span>
                <input type="text" class="search-box" id="searchInput"
                    placeholder="Search for cities, places, landmarks worldwide..." autocomplete="off">
                <div id="searchResults" class="search-results"></div>
            </div>

            <div class="guidance-box" id="guidanceBox" style="margin-left: 1rem; margin-right: auto;">
                <i class="fas fa-lightbulb" style="color: #fbbf24;"></i>
                <span style="font-size: 0.8rem; color: #a5b4fc;">Zoom/Move map to filter results</span>
            </div>

            <div class="header-actions">
                <div class="location-counter">
                    <span><i class="fas fa-map-marker-alt" style="color: #667eea;"></i></span>
                    <div>
                        <div class="count" id="totalLocations">0</div>
                        <div style="font-size: 0.7rem; color: #9ca3af;">Locations</div>
                    </div>
                </div>
                <button class="menu-btn" id="sidebarToggle">
                    <i class="fas fa-bars" style="color: #e0e0e0;"></i>
                </button>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container">
            <!-- Mobile Backdrop -->
            <div class="mobile-backdrop" id="mobileBackdrop"></div>

            <!-- Sidebar -->
            <div class="sidebar active" id="sidebar">
                <div class="filter-section">
                    <div class="section-title">Filter by Type</div>

                    <button class="filter-btn active" data-filter="all">
                        <div class="left">
                            <span class="icon">üåê</span>
                            <span>All Locations</span>
                        </div>
                        <span class="badge" id="countAll">0</span>
                    </button>

                    <button class="filter-btn" data-filter="park">
                        <div class="left">
                            <span class="icon">üå≥</span>
                            <span>Parks</span>
                        </div>
                        <span class="badge" id="countPark">0</span>
                    </button>

                    <button class="filter-btn" data-filter="landmark">
                        <div class="left">
                            <span class="icon">üèõÔ∏è</span>
                            <span>Landmarks</span>
                        </div>
                        <span class="badge" id="countLandmark">0</span>
                    </button>

                    <button class="filter-btn" data-filter="infrastructure">
                        <div class="left">
                            <span class="icon">üèóÔ∏è</span>
                            <span>Infrastructure</span>
                        </div>
                        <span class="badge" id="countInfrastructure">0</span>
                    </button>
                </div>

                <div class="locations-section">
                    <div class="section-title">Locations</div>
                    <div class="search-filter local-search-wrapper">
                        <i class="fas fa-search local-search-icon"></i>
                        <input type="text" class="filter-input local-search-input" id="localSearchInput"
                            placeholder="Filter locations by name..." autocomplete="off">
                        <button class="local-search-clear" id="localSearchClear" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="local-search-info" id="localSearchInfo" style="display: none; margin-bottom: 1rem;">
                        <i class="fas fa-info-circle"></i>
                        <span id="localSearchCount">0</span> locations found
                    </div>

                    <div class="location-list" id="locationList">
                        <!-- Locations will be populated here by app.js -->
                    </div>
                </div>
            </div>

            <!-- Map Container -->
            <div class="map-container">
                <div id="map"></div>

                <!-- Map Controls (Using new style) -->
                <div class="map-controls">
                    <button class="map-control-btn tooltip" data-tooltip="My Location" id="locateBtn">
                        <i class="fas fa-crosshairs"></i>
                    </button>
                    <button class="map-control-btn tooltip" data-tooltip="Draw Tools" id="drawToolsBtn">
                        <i class="fas fa-pencil-ruler"></i>
                    </button>
                    <button class="map-control-btn tooltip" data-tooltip="Radius Analysis" id="radiusBtn">
                        <i class="fas fa-circle-notch"></i>
                    </button>
                    <button class="map-control-btn tooltip" data-tooltip="Clear Radius" id="clearRadiusBtn"
                        style="display: none;">
                        <i class="fas fa-eraser"></i>
                    </button>
                    <button class="map-control-btn tooltip" data-tooltip="Export Map" id="exportBtn">
                        <i class="fas fa-download"></i>
                    </button>
                    <!-- Layer Toggle Button (Keep ID for compatibility if needed, but we have switcher below) 
                         We can keep it as part of top controls or rely on bottom switcher. 
                         Let's keep it but maybe hide it if the switcher replaces it? 
                         User's design has Layer button in top controls AND switcher. 
                         Let's keep it. -->

                    <button class="map-control-btn tooltip" data-tooltip="Fullscreen" id="fullscreenBtn">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>

                <!-- Layer Switcher (New Design Feature) -->
                <div class="layer-switcher">
                    <div class="layer-title">Map Style</div>
                    <div class="layer-options">
                        <button class="layer-btn active" onclick="changeMapStyle('dark')">Dark</button>
                        <button class="layer-btn" onclick="changeMapStyle('light')">Light</button>
                        <button class="layer-btn" onclick="changeMapStyle('satellite')">Satellite</button>
                    </div>
                </div>

                <!-- Info Panel (Preserved functionality) -->
                <div class="info-panel" id="infoPanel">
                    <div class="info-panel-header">
                        <div>
                            <h2 class="info-panel-title" id="infoPanelTitle">Location Name</h2>
                            <span class="location-type" id="infoPanelType">type</span>
                        </div>
                        <button class="close-btn" id="closePanelBtn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="info-panel-content" id="infoPanelContent">
                        <p id="infoPanelDescription">Description goes here...</p>

                        <div class="properties-grid" id="propertiesGrid">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-primary" id="directionsBtn">
                            <i class="fas fa-directions"></i>
                            Directions
                        </button>
                        <button class="btn btn-secondary" id="shareBtn">
                            <i class="fas fa-share-alt"></i>
                            Share
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Radius Modal (Preserved) -->
        <div class="radius-modal" id="radiusModal">
            <div class="radius-modal-content">
                <div class="radius-modal-header">
                    <h3>
                        <i class="fas fa-circle-notch"></i>
                        Radius Analysis
                    </h3>
                    <button class="close-btn" id="radiusModalClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="radius-modal-body">
                    <p>Enter radius distance for analysis</p>
                    <div class="radius-input-group">
                        <input type="number" id="radiusInput" placeholder="1.0" min="0.1" step="0.1" value="1.0">
                        <select id="radiusUnit">
                            <option value="km">Kilometers</option>
                            <option value="mi">Miles</option>
                            <option value="m">Meters</option>
                        </select>
                    </div>
                </div>
                <div class="radius-modal-footer">
                    <button class="btn btn-secondary" id="radiusCancelBtn">Cancel</button>
                    <button class="btn btn-primary" id="radiusConfirmBtn">
                        <i class="fas fa-check"></i>
                        Create Radius
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading locations...</div>
            </div>
        </div>

        <!-- Mobile Navigation Button -->
        <button class="mobile-nav-btn" id="mobileNavBtn">
            <i class="fas fa-bars"></i>
        </button>

    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>

    <!-- App Scripts -->
    <script src="{{ url_for('static', filename='js/advanced-features.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

    <!-- Map Style Switcher Logic (Simple global function for the onclicks) -->
    <script>
        // Store map styles
        const mapStyles = {
            dark: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
            light: 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',
            satellite: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
        };

        function changeMapStyle(style) {
            // Find the app instance from the global scope (we'll attach it to window in app.js if needed, 
            // or we can access the tile layer if we can find it).
            // Actually, app.js likely has `this.tileLayer`.
            // We need a way to access the app instance.

            // Temporary, safe way: Dispath a custom event that app.js listens to?
            // Or assume app.js exposes `window.gisApp`.

            if (window.gisApp && window.gisApp.map) {
                // Remove current layer if logical
                // This requires app.js to expose the tileLayer.
                // Let's implement this properly in app.js and expose it.
                window.gisApp.changeMapStyle(style);
            } else {
                console.warn('GIS App not ready');
            }

            // Update visible buttons
            document.querySelectorAll('.layer-btn').forEach(btn => btn.classList.remove('active'));
            // Find the button that was clicked (event.target)
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }
    </script>
</body>

</html>